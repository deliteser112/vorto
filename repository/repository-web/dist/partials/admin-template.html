<section class="content">
	<ol class="breadcrumb">
		<li>
			<a href="./#/">Home</a>
		</li>
		<li class="active">Manage</li>
		
		<a class="pull-right help-icon" href="https://github.com/eclipse/vorto/blob/master/docs/tutorials/managing_namespaces.md" 
			target="_blank" title="Read more about Managing Namespaces"><span class="fa fa-question-circle " />
	    </a>
	</ol>
	
	<uib-tabset justified="false">
		<uib-tab index="0">
    		<uib-tab-heading><span class="glyphicon glyphicon-link" aria-hidden="true"></span>&nbsp;Namespaces</uib-tab-heading>
    		<div namespace-management="" ng-controller="namespaceManagementController"></div>
    	</uib-tab>
    	<uib-tab ng-show="hasAuthority('sysadmin')" index="1">
    		<uib-tab-heading><i class="fa fa-info-circle"></i> Global Repository Functions</uib-tab-heading>
			
			<div ng-if="error" class="alert alert-danger">{{error}}</div>
			<div ng-if="hasIndexingError || hasForceReindexingError" class="alert alert-danger">{{ indexingError }}</div>
			<div ng-if="hasIndexingResult" class="alert alert-success">{{ indexingResultMessage }}</div>
			<h3>Reindex</h3>
			<p>Reindex the entire repository. This will purge the index and rebuild the index based on the repository.</p>
			<a ng-click="reindex()" class="btn btn-primary" ng-disabled="isReindexing">
				<i ng-show="isReindexing" class='fa fa-refresh fa-spin'></i>&nbsp;Reindex</a>
			</br>
			<hr>
			<h3>Re-create index</h3>
			<p>Move the current index to a temporary index, delete it and re-create it based on latest changes in the schema, then reindex the whole model. Backup recommended. </p>
			<a ng-click="forceReindex()" class="btn btn-primary" ng-disabled="isForceReindexing">
				<i ng-show="isForceReindexing" class='fa fa-refresh fa-spin'></i>&nbsp;Re-create index</a>
			</br>
			<hr>
			<div ng-if="hasDiagnosticsError" class="alert alert-danger">{{ diagnosticsError }}</div>
			<h3>Diagnose</h3>
			<p>Diagnose the entire repository for error.</p>
			<a ng-click="diagnose()" class="btn btn-primary"><i ng-if="isRunningDiagnostics" class='fa fa-refresh fa-spin'></i>&nbsp;Diagnose</a>
			    <table ng-if="diagnostics != null && diagnostics.length > 0" class="table table-striped table-sm">
			        <thead>
			            <tr>
			                <th style="width: 20%" scope="col">Model ID</th>
			                <th style="width: 20%" scope="col">NodeId</th>
			                <th style="width: 50%" scope="col">Diagnosis</th>
			                <th style="width: 10%" scope="col">Action</th>
			            </tr>
			        </thead>
			        <tbody>
			            <tr ng-repeat="diagnostic in diagnostics">
			                <td>{{ diagnostic.modelId.prettyFormat }}</td>
			                <td>{{ diagnostic.nodeId }}</td>
			                <td>{{ diagnostic.diagnosticMessage }}</td>
			                <td><a class="btn btn-sm btn-primary" href="./#/details/{{diagnostic.modelId.prettyFormat}}" role="button">Go to Model</a></td>
			            </tr>
			        </tbody>
			    </table>
			    <div ng-if="success && !isRunningDiagnostics" class="alert alert-success"><i class="fa fa-fw fa-check"></i> No issues found in the repository.</div>
    	</uib-tab>
		<uib-tab ng-show="hasAuthority('sysadmin')" index="2">
			<uib-tab-heading><span class="fa fa-user-md" aria-hidden="true"></span>&nbsp;Modeshape Doctor</uib-tab-heading>
			<h1>Modeshape Doctor</h1>
			<table class="table table-condensed">
				<tr>
					<td class="col-md-3"><label>Workspace ID:</label></td>
					<td class="col-md-7"><input type="text" ng-model="modeshapeWorkspaceId" style="width: 100%"></td>
				</tr>
				<tr>
					<td class="col-md-3"><label>Modeshape Path: </label></td>
					<td class="col-md-7"><input type="text" ng-model="modeshapePath" style="width: 100%"></td>
				</tr>
			</table>
			<a ng-click="readModeshapeData(modeshapeWorkspaceId, modeshapePath)" class="btn btn-primary"> Read Modeshape Data</a>
			<div ng-show="modeshapeData">
				<h2>Node Coordinates</h2>
				<div>
					Node Name: {{modeshapeData.name}}<br>
					Path: {{modeshapeData.path}}
				</div>
				<h2>Properties</h2>
				<table class="table table-bordered table-striped table-condensed" ng-show="modeshapeData.properties">
					<thead>
					<tr>
						<th class="col-md-3">Property</th>
						<th class="col-md-7">Value</th>
						<th class="col-md-2">Actions</th>
					</tr>
					</thead>
					<tbody ng-repeat="property in modeshapeData.properties">
						<tr>
							<td class="col-md-3">
								<div>
									{{property.name}}
								</div>
							</td>
							<td class="col-md-7">
								<div>
									{{property.value}}
								</div>
							</td>
							<td class="col-md-2">
								<div>
									<a ng-click="alert('not implemented yet')" data-toggle="tooltip" data-placement="bottom"
									   title="Delete Property">
										<i class="fa fa-trash fa-2x" aria-hidden="true"></i>
									</a>&nbsp;&nbsp;
									<a ng-click="alert('not implemented yet')" data-toggle="tooltip" data-placement="bottom"
									   title="Edit Property">
										<i class="fa fa-edit fa-2x" aria-hidden="true"></i>
									</a>&nbsp;&nbsp;
								</div>
							</td>
						</tr>
					</tbody>
				</table>

				<h2>Access Control Lists</h2>
				<table class="table table-bordered table-striped table-condensed" ng-show="modeshapeData.aclEntryList">
					<thead>
					<tr>
						<th class="col-md-3">Principal</th>
						<th class="col-md-7">Privileges</th>
						<th class="col-md-2">Actions</th>
					</tr>
					</thead>
					<tbody ng-repeat="aclEntry in modeshapeData.aclEntryList">
					<tr>
						<td class="col-md-3">
							<div>
								{{aclEntry.principal}}
							</div>
						</td>
						<td class="col-md-7">
							<div>
								{{aclEntry.privileges}}
							</div>
						</td>
						<td class="col-md-2">
							<div>
								<a ng-click="alert('not implemented yet')" data-toggle="tooltip" data-placement="bottom"
								   title="Delete ACL Entry">
									<i class="fa fa-trash fa-2x" aria-hidden="true"></i>
								</a>&nbsp;&nbsp;
								<a ng-click="alert('not implemented yet')" data-toggle="tooltip" data-placement="bottom"
								   title="Edit ACL Entry">
									<i class="fa fa-edit fa-2x" aria-hidden="true"></i>
								</a>&nbsp;&nbsp;
							</div>
						</td>
					</tr>
					</tbody>
				</table>

				<h2>Child Nodes</h2>
				<div ng-repeat="child in modeshapeData.childNodeNames"><a ng-click="readModeshapeData(modeshapeWorkspaceId, modeshapePath + child + '/')">{{child}}</a></div>

				<h2>Nope Operations</h2>
				<div>
					<a class="btn btn-primary" ng-disabled="!modeshapeData.contentOnNode" type="button" href="/rest/namespaces/diagnostics/modeshape/node/{{modeshapeWorkspaceId}}/data?path={{modeshapePath}}">
						Download JCR Data
					</a>
					<button class="btn btn-danger" type="button" ng-click="deleteModeshapeNode(modeshapeWorkspaceId, modeshapePath)">
						Delete Node {{modeshapeData.name}}
					</button>
				</div>
			</div>
		</uib-tab>
  	</uib-tabset>
</section>
